# Инструкция по использованию Distributed Solver

## Быстрый старт

### 1. Проверка установки .NET

Убедитесь, что установлен .NET 8.0 SDK:

```bash
dotnet --version
```

Должно быть `8.0.x` или выше.

### 2. Сборка проекта

```bash
dotnet build DistributedSolver.sln
```

### 3. Запуск серверов

Откройте несколько терминалов и запустите сервисы:

**Терминал 1 — координатор:**
```bash
dotnet run --project DistributedSolver.Coordinator
```

Координатор запустится на порту `5000`. В логах появится:
```
Координатор запущен на порту 5000
Swagger UI доступен по адресу: http://localhost:5000/swagger
```

**Терминалы 2-7 — воркеры:**
```bash
dotnet run --project DistributedSolver.Worker -- 6001
dotnet run --project DistributedSolver.Worker -- 6002
dotnet run --project DistributedSolver.Worker -- 6003
# ... и т.д.
```

Каждый воркер автоматически зарегистрируется на координаторе.

### 4. Запуск клиента

```bash
dotnet run --project DistributedSolver.Client
```

Или используйте `DistributedSolver.Client\Launch_Client.bat`.

## Использование клиента

### Загрузка данных

1. **Загрузка матрицы:**
   - Нажмите кнопку **"Матрица"** в разделе "ЗАГРУЗКА ДАННЫХ"
   - Выберите текстовый файл с матрицей (например, `datasets/matrix_3x3.txt`)

2. **Загрузка свободных членов:**
   - Нажмите кнопку **"Вектор B"**
   - Выберите файл (например, `datasets/freeterms_3x3.txt`)

3. **Загрузка узлов (опционально):**
   - Нажмите кнопку **"Узлы"**
   - Выберите файл с узлами (например, `datasets/nodes.txt`)
   - Или используйте **"Workers"** для автоматического получения списка воркеров с координатора

### Генерация матриц

#### Быстрая генерация

1. Введите размер системы в текстовое поле (например, `100`)
2. Нажмите кнопку **"Случайная"**

#### Расширенный генератор

1. Нажмите кнопку **"Расширенный генератор..."**
2. Выберите размер матрицы (1-50000)
3. Выберите тип матрицы:
   - **Хорошо обусловленная** — рекомендуется для стабильности
   - **Случайная матрица** — с настраиваемым диапазоном значений
   - **С известным решением** — для проверки точности
4. Нажмите **"Создать"**

### Решение системы

После загрузки или генерации данных доступны следующие опции:

1. **Распределённый запуск** — многопоточный метод Гаусса на одном воркере
2. **Линейный запуск** — однопоточный метод для сравнения
3. **Сравнение методов** — автоматически запускает оба метода и сравнивает результаты
4. **Тест воркеров** — отправляет задачи на все доступные воркеры с разными методами
5. **Остановить** — отменяет текущие задачи

### Просмотр результатов

- **Вкладка "Сравнение"** — таблица с метриками производительности:
  - Метод
  - Время выполнения (секунды)
  - Погрешность
  - Ускорение относительно базового метода
  - Статус

- **Вкладка "Решение"** — вектор решения:
  - Номер переменной
  - Значение в научной нотации
  - Значение в обычной нотации

- **Вкладка "Узлы"** — мониторинг задач:
  - Имя воркера
  - Метод решения
  - Прогресс выполнения
  - Сообщения об ошибках

- **Вкладка "Логи"** — системный лог с временными метками

### Сохранение результатов

1. **Сохранить матрицу** — сохраняет текущую матрицу в текстовый файл
2. **Сохранить решение** — сохраняет вектор решения с метаданными
3. **Сохранить сравнение** — сохраняет таблицу сравнения методов в текстовый формат

## Формат файлов

### Матрица системы

Текстовый файл, где каждая строка содержит элементы строки матрицы, разделённые пробелами или табуляцией.

**Пример (3×3):**
```
2  1 -1
-3 -1  2
-2  1  2
```

### Свободные члены

Текстовый файл, где каждая строка содержит один свободный член.

**Пример:**
```
8
-11
-3
```

### Файл узлов

Текстовый файл со списком узлов в формате `адрес:порт`, по одному на строку. Строки, начинающиеся с `#`, игнорируются.

**Пример:**
```
localhost:6001
localhost:6002
localhost:6003
```

## Тестирование

### Запуск всех тестов

```bash
dotnet test DistributedSolver.Tests/DistributedSolver.Tests.csproj
```

### Запуск по категориям

```bash
# Модульные тесты
dotnet test --filter "FullyQualifiedName~UnitTests"

# Интеграционные тесты
dotnet test --filter "FullyQualifiedName~IntegrationTests"

# Нагрузочные тесты
dotnet test --filter "FullyQualifiedName~LoadTests"
```

## Устранение неполадок

### Сервер не запускается

- Убедитесь, что порт не занят другим приложением
- Проверьте, что .NET 8.0 SDK установлен
- Проверьте логи ошибок в консоли

### Ошибка подключения к узлам

- Убедитесь, что все серверы запущены
- Проверьте правильность адресов и портов в файле узлов
- Проверьте доступность узлов через браузер: `http://localhost:6001/api/Computation/health`

### Ошибка при решении

- Убедитесь, что матрица квадратная
- Проверьте, что размер матрицы совпадает с количеством свободных членов
- Для больших систем (более 1000) убедитесь, что есть достаточно памяти
- Проверьте логи воркера на наличие ошибок

### Воркеры не регистрируются

- Проверьте, что координатор запущен и доступен
- Проверьте переменную окружения `COORDINATOR_URL` у воркеров
- Проверьте логи воркера на ошибки подключения

### Клиент не может подключиться к координатору

- Убедитесь, что координатор запущен на `http://localhost:5000`
- Проверьте, что порт 5000 не заблокирован файрволом
- Попробуйте открыть `http://localhost:5000/api/Coordinator/health` в браузере

## Производительность

### Рекомендации

- **Распределённый метод** эффективен для систем размером более 500 неизвестных
- **Линейный метод** может быть быстрее для малых систем (< 100) из-за отсутствия накладных расходов
- Рекомендуется использовать 3-6 воркеров для оптимальной производительности
- Многопоточный метод автоматически использует все доступные ядра процессора

### Оптимизация

- Для больших матриц (> 5000) используйте генератор хорошо обусловленных матриц
- Используйте функцию "Сравнение методов" для выбора оптимального метода для вашей системы
- Мониторьте прогресс выполнения во вкладке "Узлы"

## API примеры

### Регистрация воркера

```bash
curl -X POST http://localhost:5000/api/Coordinator/register \
  -H "Content-Type: application/json" \
  -d '{"url": "http://localhost:6001"}'
```

### Получение списка воркеров

```bash
curl http://localhost:5000/api/Coordinator/workers
```

### Отправка задачи на решение

```bash
curl -X POST "http://localhost:5000/api/Coordinator/solve?method=distributed" \
  -H "Content-Type: application/json" \
  -d '{
    "matrix": [[2,1,-1],[-3,-1,2],[-2,1,2]],
    "freeTerms": [8,-11,-3]
  }'
```

### Получение статуса задачи

```bash
curl "http://localhost:5000/api/Coordinator/tasks/status?taskIds=1"
```
